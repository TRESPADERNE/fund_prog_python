
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ficheros &#8212; Fundamentos de Programación en Python</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Fundamentos de Programación en Python</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../0_Python/Introduccion_Python.html">
   Introducción a Python
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../1_Expresiones_operadores_y_tipos_de_datos/Expresiones_operadores_y_tipos_de_datos.html">
   Operadores, expresiones y tipos de datos
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/notebooks/12_Ficheros/img/Intro_ficheros.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://https://github.com/TRESPADERNE/fund_prog_python"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://https://github.com/TRESPADERNE/fund_prog_python/issues/new?title=Issue%20on%20page%20%2Fnotebooks/12_Ficheros/img/Intro_ficheros.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/TRESPADERNE/fund_prog_python/master?urlpath=tree/notebooks/12_Ficheros/img/Intro_ficheros.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contenidos">
   Contenidos
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduccion">
   Introducción
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#concepto-de-fichero">
   Concepto de fichero
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#utilidad-de-los-ficheros">
     Utilidad de los ficheros
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tipos-de-ficheros">
   Tipos de ficheros
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#elementos-basicos-de-programacion-con-ficheros-de-texto">
   Elementos básicos de programación con ficheros de texto
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#el-concepto-de-flujo-de-datos-stream">
     El concepto de flujo de datos (stream)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#memoria-intermedia-buffers">
     Memoria intermedia (buffers)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#necesidad-de-cerrar-el-fichero">
       Necesidad de cerrar el fichero
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lectura-linea-por-linea-de-ficheros-en-python">
   Lectura línea por línea de ficheros en Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#la-apertura-y-el-cierre">
     La apertura y el cierre
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lectura-linea-por-linea">
     Lectura línea por línea
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manejo-de-excepciones-con-ficheros">
   Manejo de excepciones con ficheros
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#el-administrador-de-recursos-with">
     El administrador de recursos
     <code class="docutils literal notranslate">
      <span class="pre">
       with
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#otras-formas-de-lectura-en-python">
   Otras formas de lectura en Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ejemplo-de-uso-de-readlines">
     Ejemplo de uso de
     <code class="docutils literal notranslate">
      <span class="pre">
       readlines()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ejemplo-de-uso-de-read">
     Ejemplo de uso de
     <code class="docutils literal notranslate">
      <span class="pre">
       read()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#leyendo-un-fichero-con-formato-complejo">
   Leyendo un fichero con formato complejo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#escritura-en-un-fichero">
   Escritura en un fichero
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#consideraciones-finales">
   Consideraciones finales
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="ficheros">
<h1>Ficheros<a class="headerlink" href="#ficheros" title="Permalink to this headline">¶</a></h1>
<p><strong>Autores</strong>: Rogelio Mazaeda Echevarría, Félix Miguel Trespaderne.</p>
<div class="section" id="contenidos">
<h2>Contenidos<a class="headerlink" href="#contenidos" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="#Introducci%C3%B3n">Introducción</a><br>
<a class="reference external" href="#Concepto_de_fichero">Concepto de fichero</a><br>
<a class="reference external" href="#Tipos_de_fichero">Tipos de ficheros</a><br>
<a class="reference external" href="#Ficheros_b%C3%A1sico">Elementos básicos de programación con ficheros</a><br>
<a class="reference external" href="#Lectura_l%C3%ADnea_por_l%C3%ADnea_de_ficheros_en_Python">Lectura línea por línea de ficheros en Python</a><br>
<a class="reference external" href="#Manejo_de_excepciones_con_ficheros">Manejo de excepciones con ficheros</a><br>
<a class="reference external" href="#Otras_formas_de_lectura_en_Python">Otras formas de lectura en Python</a><br>
<a class="reference external" href="#Leyendo_un_fichero_con_formato_complejo">Leyendo un fichero con formato complejo</a><br>
<a class="reference external" href="#Escritura_en_un_fichero">Escritura en un fichero</a><br>
<a class="reference external" href="#Consideraciones_finales">Consideraciones finales</a></p>
<hr class="docutils" />
<p><a id='Introducción'></a></p>
<hr class="docutils" />
<p><a id='Introducción'></a></p>
</div>
<div class="section" id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Permalink to this headline">¶</a></h2>
<p>Toda persona que haya interactuado con los ordenadores tiene alguna idea de lo que es un <strong>fichero</strong>. Sabemos que determinadas aplicaciones informáticas los crean para almacenar, por ejemplo, los documentos generados por un editor de textos o una hoja de cáculo. Conocemos que las aplicaciones son preservadas en ficheros ejecutables. Por otro lado, día tras día copiamos ficheros de una carpeta del disco duro a otra, o hacia una memoria USB, ¡o los borramos definitivamente!</p>
<p>En este tema haremos primero una breve introducción al concepto informático de fichero. Posteriormente, veremos algunas de las herramientas básicas, las más habituales, que proporciona Python para trabajar con ficheros.</p>
<hr class="docutils" />
<p><a id='Concepto_de_fichero'></a></p>
</div>
<div class="section" id="concepto-de-fichero">
<h2>Concepto de fichero<a class="headerlink" href="#concepto-de-fichero" title="Permalink to this headline">¶</a></h2>
<p><strong>Un fichero es un conjuntos de datos relacionados entre sí</strong>, que son almacenados de forma <strong>permanente</strong> en dispositivos tales como discos duros, memorias <em>flash</em>, etc. y que pueden ser tratados, hasta cierto punto, como una unidad.</p>
<p>En este contexto, <strong>permanente</strong> quiere decir que, salvo fallos catastróficos o hasta que sean borrados a propósito, estos datos permanecen en el medio en que se almacenan (medios magnéticos o de otro tipo) y continuan existiendo después de que el programa que los creó deja de ejecutarse, incluso después de apagar el ordenador.</p>
<p>Esto marca la diferencia con los datos que son provisionalmente almacenados en la memoria RAM, la <strong>memoria volátil</strong> del ordenador, que no <em>sobreviven</em> al programa que los crea y mucho menos a la desconexión del computador de la red eléctrica.</p>
<div class="section" id="utilidad-de-los-ficheros">
<h3>Utilidad de los ficheros<a class="headerlink" href="#utilidad-de-los-ficheros" title="Permalink to this headline">¶</a></h3>
<p>El concepto de fichero es una <strong>abstracción</strong> del <strong>Sistema Operativo</strong> (<strong>S.O.</strong>), que de forma transparente al programador,  utiliza los recursos del <em>hardware</em> creando sobre ellos una estructura lógica para representarlos, facilitando a los lenguajes de programación el uso de interfaces de usuario simples y versátiles.</p>
<p>El Sistema Operativo crea todo el <strong>sistema de ficheros</strong> del ordenador: los directorios para organizarlos, las tablas para localizarlos en el disco, etc.</p>
<p>Los ficheros son enormemente importantes en programación. No sólo debido al hecho evidente de que brindan el soporte que permite la mera existencia de las aplicaciones en el disco duro. Si no existieran los ficheros, por ejemplo, toda la interacción del usuario con una aplicación concreta, como la introducción y la obtención de resultados parciales, tendría que ser laboriosamente recreada cada vez que se ejecutara el programa. La existencia del fichero hace posible que, al terminar una sesión de trabajo, se almacenen los datos y resultados en el disco, para poder retormar la tarea en una sesión posterior.</p>
<p>Por otra parte, los ficheros pueden ser útiles como vehículos para el intercambio de información entre diferentes aplicaciones: los datos resultantes <em>escritos</em> en un fichero por el programa A podrán servir de <em>entrada</em> para un programa B.</p>
<hr class="docutils" />
<p><a id='Tipos_de_fichero'></a></p>
</div>
</div>
<div class="section" id="tipos-de-ficheros">
<h2>Tipos de ficheros<a class="headerlink" href="#tipos-de-ficheros" title="Permalink to this headline">¶</a></h2>
<p>El <strong>contenido</strong> y la <strong>estructura</strong> de un fichero responde a un criterio de <strong>diseño libre</strong>, elegido por el desarrollador de una aplicación. En cualquier caso, en relación a la forma en que los datos son almacenados, los ficheros se clasifican en:</p>
<ul class="simple">
<li><p><strong>Ficheros binarios</strong>: Contienen un representación exacta del contenido (binario en ceros y unos) de los datos.
No son editables.</p></li>
</ul>
<blockquote>
<div><p>Ejemplo: Representación de 3 números enteros 255 3 10 en complemento a 2. Cada entero ocupa el mismo número de bytes.
<img alt="fichero_binario" src="notebooks\12_Ficheros\img\img/fichero_binario.jpg" /></p>
</div></blockquote>
<ul class="simple">
<li><p><strong>Ficheros de texto</strong>: Los datos están representados con los carácteres alfanumúmericos que los representan. Pueden ser leídos y modificados a través de un editor de texto.</p></li>
</ul>
<blockquote>
<div><p>Ejemplo: Representación de 3 números enteros 255 3 10 codificados en ASCCI, separados por espacios en blanco (20H en ASCII). Cada entero ocupa un número de bytes distinto.
<img alt="fichero_texto" src="notebooks\12_Ficheros\img\img/fichero_texto.jpg" /></p>
</div></blockquote>
<p>En este curso, trabajaremos fundamentalmente con ficheros de texto. Veremos que el trabajo con los ficheros de texto es esencialmente análogo al trabajo con entrada/salida convencional a través de la consola (habitualmente el teclado y la pantalla).</p>
<hr class="docutils" />
<p><a id='Ficheros_básico'></a></p>
</div>
<div class="section" id="elementos-basicos-de-programacion-con-ficheros-de-texto">
<h2>Elementos básicos de programación con ficheros de texto<a class="headerlink" href="#elementos-basicos-de-programacion-con-ficheros-de-texto" title="Permalink to this headline">¶</a></h2>
<p>La <strong>equivalencia</strong> entre entrada/salida a través de teclado y pantalla y la utilización de ficheros es muy profunda. Los S.O. actuales hacen un tratamiento unificado de estos recursos y tratan, por ejemplo, a la pantalla y al teclado como ficheros de salida y de entrada respectivamente, <em>ficheros</em> que están siempre <em>listos</em> para ser utilizados. Es una muestra más del mecanismo de abstracción mencionado más arriba.</p>
<p>Recalquemos que cuando en Python usamos <code class="docutils literal notranslate"><span class="pre">print()</span></code>, estamos escribiendo datos en el fichero <em>por defecto</em> o <em>estándar</em>, la pantalla, y que cuando empleamos <code class="docutils literal notranslate"><span class="pre">input()</span></code>, estamos leyendo datos en el fichero <em>por defecto</em> o <em>estándar</em>, el teclado.</p>
<p>Cuando no usamos los <em>ficheros estándar</em>, tanto en Python como en cualquier otro lenguaje de programación, debemos realizar algunas tareas <em>adicionales</em>:</p>
<ul class="simple">
<li><p><strong>Abrir el fichero</strong>: hay que asociar el fichero (definido a nivel del S.O.) con un <em>objeto</em> que provea la fuente de datos y definir si se va utilizar para entrada o para salida de datos, es decir, para leer o para escribir.</p></li>
<li><p><strong>Cerrar el fichero</strong>: Una vez finalizada la interacción con el <em>objeto</em> que representa el fichero, este hecho debe ser informado al S.O. mediante los métodos apropiados. Así, el S.O. podrá realizar las acciones requeridas para garantizar que el fichero queda en un estado consistente y seguro.</p></li>
</ul>
<div class="section" id="el-concepto-de-flujo-de-datos-stream">
<h3>El concepto de flujo de datos (stream)<a class="headerlink" href="#el-concepto-de-flujo-de-datos-stream" title="Permalink to this headline">¶</a></h3>
<p>Las operaciones de lectura/escritura hacen uso del concepto de <strong>flujo</strong> o <strong>corriente</strong> de datos (<strong>stream</strong>). El símil se basa en el hecho de interpretar la entrada/salida como una corriente o río de datos, donde estos son representados por la aparición <strong>en serie</strong>, uno tras otro, de los <strong>bytes</strong> que  representan cada uno de los valores transferidos.</p>
<p>El concepto de transferencia de datos en serie es clave. Si desde el teclado queremos introducir el número 543, es evidente que antes de escribir el 3, debemos escribir el 4 y antes el 5. En el caso de los ficheros se utiliza el mismo paradigma, se escribe un dato siempre a continuación del anterior.</p>
<p><img alt="esquema_fichero.jpg" src="notebooks\12_Ficheros\img\img/esquema_fichero.jpg" /></p>
<p>La figura previa describe la relación que existe entre los datos almacenados en el medio físico y la <em>construcción lógica</em> que es el fichero.
A nivel del dispositivo periférico, la forma de referirse al dato es a través de atributos de muy <em>bajo nivel</em>, tales como su <em>dirección</em>, que puede ser descrita, por ejemplo, por la intersección de <em>cilindros</em> y <em>sectores</em> definidos por el <em>hardware</em>.</p>
<p>El <strong>fichero</strong>, por su parte, es un conjunto <strong>lógico</strong> de datos que el programa que lo crea (con la ayuda indespensable del Sistema Operativo) <em>decide</em> tratarlos como una unidad. Nótese, que en el nivel hardware, si se usa un disco duro como almacenamiento, ese conjunto lógico involcrará a múltiples <em>cilindros</em> y <em>sectores</em>.</p>
</div>
<div class="section" id="memoria-intermedia-buffers">
<h3>Memoria intermedia (buffers)<a class="headerlink" href="#memoria-intermedia-buffers" title="Permalink to this headline">¶</a></h3>
<p>La entrada/salida desde/hacia <strong>ficheros</strong> está mediada, de forma transparente al programador, por memoria auxiliar o búferes (<strong>buffers</strong>).</p>
<p>Los <strong>búferes</strong> cumplen distintos cometidos, pero el fundamental es el de servir como <strong>pulmón</strong> de la CPU. Dado que los procesos de lectura/escritura en los dispositivos son mucho más lentos que los realizados en la RAM, los datos son temporalmente leídos/escritos en búferes. De esta forma, los accesos a un dispositivo lento no ralentizan las aplicaciones.</p>
<div class="section" id="necesidad-de-cerrar-el-fichero">
<h4>Necesidad de cerrar el fichero<a class="headerlink" href="#necesidad-de-cerrar-el-fichero" title="Permalink to this headline">¶</a></h4>
<p>Cuando nuestro programa ha terminado de utilizar el <strong>fichero</strong> debe <strong>cerrarlo</strong>. ¿Por qué es necesario cerrar el fichero?</p>
<ul class="simple">
<li><p>La escritura/lectura se realiza sobre los <em>búferes</em> y estos son eventualmente transferidos al medio físico. Cuando se <em>cierra</em> el fichero, se <strong>fuerza</strong> a realizar esa transferencia. De otro modo, se podría incurrir en pérdida de información.</p></li>
<li><p>La utilización de un fichero comporta un consumo importante de memoria del ordenador (<em>búferes</em> y otros elementos). Si no se cierra el fichero, esa memoria resulta <em>inutilizada</em>.</p></li>
<li><p>El Sistema Operativo establece un número máximo de ficheros que pueden estar <em>abiertos</em> simultáneamente. Si no <em>cerramos</em> los ficheros que, de momento, no estamos utilizando, puede que nuestro programa no pueda <em>abrir</em> otros que si son necesarios.</p></li>
</ul>
<hr class="docutils" />
<p><a id='Lectura_línea_por_línea_de_ficheros_en_Python'></a></p>
</div>
</div>
</div>
<div class="section" id="lectura-linea-por-linea-de-ficheros-en-python">
<h2>Lectura línea por línea de ficheros en Python<a class="headerlink" href="#lectura-linea-por-linea-de-ficheros-en-python" title="Permalink to this headline">¶</a></h2>
<p>Para entender el manejo de ficheros en Python utilizaremos inicialmente un sencillo ejemplo. Para ello, utilizaremos un editor de textos con el que hemos creado un archivo llamado <em>valores_en_columna.txt</em>. El contenido es una secuencia de valores enteros fácil de recordar, para que las comprobaciones del buen funcionamiento del código sean sencillas de verificar.
<img alt="valores_en_columna.jpg" src="notebooks\12_Ficheros\img\img/valores_en_columna.jpg" /></p>
<p>De momento, para simplificar la <strong>ruta de acceso</strong> al fichero, este archivo está situado al mismo nivel que este cuaderno. La extensión <code class="docutils literal notranslate"><span class="pre">.txt</span></code> es la habitual para <em>recalcar</em> que el fichero es de tipo texto, pero podemos usar cualquier extensión, preferentemente no utilizando aquellas habituales en aplicaciones estándar, tales como <code class="docutils literal notranslate"><span class="pre">.doc</span></code>, <code class="docutils literal notranslate"><span class="pre">.exe</span></code>, <code class="docutils literal notranslate"><span class="pre">.lib</span></code>, <code class="docutils literal notranslate"><span class="pre">.pdf</span></code>, etc.</p>
<div class="section" id="la-apertura-y-el-cierre">
<h3>La apertura y el cierre<a class="headerlink" href="#la-apertura-y-el-cierre" title="Permalink to this headline">¶</a></h3>
<p>Los ficheros no estándar deben ser abiertos antes de ser utilizados, y cerrados cuando se concluya (al menos provisionalemente) el trabajo con ellos.</p>
<p>Para abrir un fichero debemos tener en cuenta:</p>
<ul class="simple">
<li><p>La localización del fichero: (Ej: “<em>datos/temperaturas/Valladolid.dat</em>”)</p></li>
<li><p>La declaración del <strong>modo de apertura</strong>, que es un parámetro que indica si, por ejemplo, queremos leer del fichero o escribir en el fichero (Ej: <code class="docutils literal notranslate"><span class="pre">'w'</span></code>: escritura, <code class="docutils literal notranslate"><span class="pre">'r'</span></code>: lectura)</p></li>
<li><p>La asignación de un nombre en el programa que a partir de ese momento representará al fichero (Ej: <code class="docutils literal notranslate"><span class="pre">fich_sal</span></code>)</p></li>
</ul>
<p>Para abrir un fichero disponemos de la función <code class="docutils literal notranslate"><span class="pre">open()</span></code> que nos devuelve el <strong>objeto</strong> fichero con el que vamos a poder trabajar a partir de ese momento. En el ejemplo, se abre un fichero <code class="docutils literal notranslate"><span class="pre">'Valladolid.dat'</span></code> especificando la ruta de acceso desde el <strong>directorio de trabajo</strong>, con la intención de escribir en el datos, (<code class="docutils literal notranslate"><span class="pre">'w'</span></code>) y al que se referenciará con el nombre <code class="docutils literal notranslate"><span class="pre">fich_sal</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fich_sal</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;datos/temperaturas/Valladolid.dat&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>En la siguiente tabla se muestran los diferentes <strong>modos de apertura</strong>. Con saber utilizar los modos <code class="docutils literal notranslate"><span class="pre">'w'</span></code> y <code class="docutils literal notranslate"><span class="pre">'r'</span></code> es más que suficiente para los objetivos del curso.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>modo de apertura</p></th>
<th class="text-align:center head"><p>Descripción</p></th>
<th class="text-align:center head"><p>Acción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'w'</span></code></p></td>
<td class="text-align:center"><p>Escritura</p></td>
<td class="text-align:center"><p>Si el fichero no existe lo crea. Si existe, borra su contenido</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'r'</span></code></p></td>
<td class="text-align:center"><p>Lectura</p></td>
<td class="text-align:center"><p>Si existe fichero: lo abre. Si no existe: excepción <code class="docutils literal notranslate"><span class="pre">FileNotFoundError</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'a'</span></code></p></td>
<td class="text-align:center"><p>Añadir</p></td>
<td class="text-align:center"><p>Si fichero no existe, lo crea para escritura. Si existe, añade al final</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'w+'</span></code></p></td>
<td class="text-align:center"><p>Actualizar</p></td>
<td class="text-align:center"><p>Escritura/ lectura. Si el fichero no existe lo crea. Si existe: borra</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'r+'</span></code></p></td>
<td class="text-align:center"><p>Actualizar</p></td>
<td class="text-align:center"><p>Lectura/Escritura. Si no existe: excepción <code class="docutils literal notranslate"><span class="pre">FileNotFoundError</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'a+'</span></code></p></td>
<td class="text-align:center"><p>Añadir</p></td>
<td class="text-align:center"><p>Escritura/lectura. Si existe, añade al final.</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'b'</span></code></p></td>
<td class="text-align:center"><p>Binario</p></td>
<td class="text-align:center"><p>Abre en binario. Combinadas con otras banderas: establece modo</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">'x'</span></code></p></td>
<td class="text-align:center"><p>Creación</p></td>
<td class="text-align:center"><p>Abre exclusivamente para crear fichero. Si ya existe, falla</p></td>
</tr>
</tbody>
</table>
<p>Para cerrar el fichero se usa el método <code class="docutils literal notranslate"><span class="pre">close()</span></code>. Siguiendo con el ejemplo anterior:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fich_sal</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;datos/temperaturas/Valladolid.dat&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="c1"># Código de escritura en el fichero</span>
<span class="c1"># ...</span>
<span class="n">fich_sal</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cerramos el fichero</span>
</pre></div>
</div>
<p>En las diferentes celdas que siguen a continuación vamos a utilizar el <strong>comando mágico</strong> de <strong>IPython</strong> <code class="docutils literal notranslate"><span class="pre">%reset</span> <span class="pre">-f</span></code> para resetear las variables del espacio de nombres y que los resultados de una celda no influyan en las otras.</p>
<p>Los comandos mágicos fueron tratados en la sesión de laboratorio 1 en el cuaderno <em>Introduccion_Jupyter_Notebook.ipynb</em>.</p>
</div>
<div class="section" id="lectura-linea-por-linea">
<h3>Lectura línea por línea<a class="headerlink" href="#lectura-linea-por-linea" title="Permalink to this headline">¶</a></h3>
<p>Tras abrir el fichero correspondiente, la forma básica de leer un fichero línea por línea es:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nombre_fichero.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich_ent</span><span class="p">:</span>
    <span class="c1"># Procesar la línea</span>
<span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>La variable <code class="docutils literal notranslate"><span class="pre">linea</span></code> es una <strong>cadena de caracteres</strong> que va tomando secuencialmente las cadenas de caracteres correspondientes a cada una de las líneas del fichero, desde la primera a la última.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot; línea a línea</span>
<span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>  <span class="c1"># Apertura</span>

<span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich_ent</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">linea</span><span class="p">)</span>
    
<span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">2048926</span><span class="n">fdf5a</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot; línea a línea</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>  <span class="c1"># Apertura</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich_ent</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="nb">print</span><span class="p">(</span><span class="n">linea</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;valores_en_columna.txt&#39;
</pre></div>
</div>
</div>
</div>
<p>Al ejecutar el código observaréis que aparece una línea en blanco entre cada uno de los números. Esto es así porque cada línea en el fichero de texto tiene un carácter no imprimible de retorn de línea, el carácter <code class="docutils literal notranslate"><span class="pre">\n</span></code>. A eso se une el que por defecto introduce la función <code class="docutils literal notranslate"><span class="pre">print()</span></code>.</p>
<p>Este hecho debe recordarnos que, al igual que con la función de lectura estándar <code class="docutils literal notranslate"><span class="pre">input()</span></code>, lo que estamos leyendo son cadenas de caracteres, es decir, línea es un dato tipo <code class="docutils literal notranslate"><span class="pre">str</span></code>. Para poder utilizar los valores enteros, podemos recurrir a la función <code class="docutils literal notranslate"><span class="pre">int()</span></code>.</p>
<p>En el siguiente ejemplo, rehacemos el código para almacenar los valores en una lista.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  línea a línea</span>
<span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>  <span class="c1"># Apertura</span>

<span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich_ent</span><span class="p">:</span>
    <span class="n">lista_enteros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">)</span>
    
<span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
</pre></div>
</div>
</div>
</div>
<p>Es muy importante darnos cuenta que el éxito en la lectura del fichero se sustenta en el hecho de que conocemos de antemano su <strong>formato</strong>. En este caso, que el fichero está formado por líneas en las cuales hay un único número entero. Si ese formato no se cumple, tendremos problemas.</p>
<p>Veamos qué ocurre si pretendemos utilizar el mismo código con el fichero <em>valores_en_fila.txt</em>.
<img alt="valores_en_columna.jpg" src="notebooks\12_Ficheros\img\img/valores_en_fila.jpg" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_fila.txt&quot; línea a línea</span>
<span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_fila.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>  <span class="c1"># Apertura</span>

<span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich_ent</span><span class="p">:</span>
    <span class="n">lista_enteros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">)</span>
    
<span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">51</span><span class="n">c9965f9dba</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich_ent</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">7</span>     <span class="n">lista_enteros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> 
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="nb">print</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">)</span>

<span class="ne">ValueError</span>: invalid literal for int() with base 10: &#39;1 2 3 4 5 6 7 8 9 10\n&#39;
</pre></div>
</div>
</div>
</div>
<p>Afortunadamente, tenemos una <em>bonita</em> excepción:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="ne">ValueError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">literal</span> <span class="k">for</span> <span class="nb">int</span><span class="p">()</span> <span class="k">with</span> <span class="n">base</span> <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;1 2 3 4 5 6 7 8 9 10</span><span class="se">\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>El análisis del mensaje nos da luz acerca del problema. La primera línea del fichero es la cadena de caracteres <code class="docutils literal notranslate"><span class="pre">'1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6</span> <span class="pre">7</span> <span class="pre">8</span> <span class="pre">9</span> <span class="pre">10\n'</span></code>, que Python lógicamente es incapaz de convertir a un entero vía la función <code class="docutils literal notranslate"><span class="pre">int()</span></code>. Observad la presencia del carácter retorno de línea al final <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
<p>Decimos afortunadamente porque no hay nada mejor que, de forma automática, el motor de ejecución de Python nos informe de que algo estamos haciendo mal. Imaginad que la ejecución no diese error y en una importante variable de nuestra aplicación cargamos un valor espurio.</p>
<p>Veremos más adelante como leer este fichero.</p>
<hr class="docutils" />
<p><a id='Manejo_de_excepciones_con_ficheros'></a></p>
</div>
</div>
<div class="section" id="manejo-de-excepciones-con-ficheros">
<h2>Manejo de excepciones con ficheros<a class="headerlink" href="#manejo-de-excepciones-con-ficheros" title="Permalink to this headline">¶</a></h2>
<p>En el caso del uso de <strong>ficheros</strong>, la capacidad de responder de forma consistente a errores que se puedan producir, es muy importante. Hay que tener en cuenta, que cuando se trata de ficheros, existen una serie de elementos <em>externos</em> que dependen del <em>hardware</em> y del <strong>Sistema Operativo</strong> que pueden fallar y que están fuera del control del programador.</p>
<p>Por ejemplo:</p>
<ul class="simple">
<li><p>El fichero que se pretende <em>abrir</em> para <em>lectura</em> no existe.</p></li>
<li><p>Se pretende <em>abrir</em> para <em>escritura</em> un fichero en un medio físico (dispositivo) o lógico (carpeta) <em>protegido</em> contra escritura.</p></li>
</ul>
<p>Otro fallos pueden ser debidos a:</p>
<ul class="simple">
<li><p>La estructura o formato que se espera del fichero, no es la realmente existente.</p></li>
</ul>
<blockquote>
<div><p>Acabamos de el ejemplo más arriba con el fichero <em>valores_en_fila.txt</em>.</p>
</div></blockquote>
<ul class="simple">
<li><p>Durante la lectura del fichero, se produce otro tipo de excepción, como una división por 0, etc.</p></li>
</ul>
<p>Vamos a generar artificialmente una excepción <code class="docutils literal notranslate"><span class="pre">IndexError</span></code> y a capturarla debidamente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  línea a línea</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1"># Línea &quot;artificial&quot; para generar un error de índice en nuestro ejemplo</span>
    <span class="c1"># Cambiando 9 por 10 el programa no genera error</span>
    <span class="n">num_valores</span> <span class="o">=</span> <span class="mi">9</span>  
    <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">num_valores</span>  
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fich_ent</span><span class="p">):</span>
        <span class="n">lista_enteros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cerramos el fichero.&#39;</span><span class="p">)</span>
    <span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>list assignment index out of range
Cerramos el fichero.
</pre></div>
</div>
</div>
</div>
<p>Aquí vemos entrar en acción al bloque <code class="docutils literal notranslate"><span class="pre">finally</span></code>, un bloque concebido para ser destinado a cerrar recursos abiertos, una especie de <em>coche escoba</em>. Tanto si existe excepción como si no, el fichero está abierto y debemos cerrarlo.</p>
<p>Vamos ahora a provocar otro error típico: nos equivocamos al transcibir el nombre. En el siguiente ejemplo, hemos empleado <code class="docutils literal notranslate"><span class="pre">colunna</span></code> en lugar de <code class="docutils literal notranslate"><span class="pre">columna</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  línea a línea</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_colunna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1"># Línea &quot;artificial&quot; para generar un error de índice en nuestro ejemplo</span>
    <span class="c1"># Cambiando 9 por 10 el programa no genera error</span>
    <span class="n">num_valores</span> <span class="o">=</span> <span class="mi">9</span>  
    <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">num_valores</span>  
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fich_ent</span><span class="p">):</span>
        <span class="n">lista_enteros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cerramos el fichero.&#39;</span><span class="p">)</span>
    <span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cerramos el fichero.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">d3392351fee3</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_colunna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="c1"># Línea &quot;artificial&quot; para generar un error de índice en nuestro ejemplo</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;valores_en_colunna.txt&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">d3392351fee3</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cerramos el fichero.&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">17</span>     <span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>

<span class="ne">NameError</span>: name &#39;fich_ent&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><strong>¡Tenemos dos excepciones</strong>!</p>
<ul class="simple">
<li><p>La excepción <code class="docutils literal notranslate"><span class="pre">FileNotFoundError</span></code> es bastante descriptiva del tipo de error cometido.</p></li>
<li><p>La excepción <code class="docutils literal notranslate"><span class="pre">NameError</span></code> nos está diciendo que no conoce la existencia de la variabe <code class="docutils literal notranslate"><span class="pre">fich_ent</span></code>. Pero, ¡la tenemos definida en la línea <code class="docutils literal notranslate"><span class="pre">fich_ent</span> <span class="pre">=</span> <span class="pre">open('valores_en_colunna.txt','r')</span></code>!. Raro ¿no?.</p></li>
</ul>
<p>Vamos, de momento, a manejar la excepción <code class="docutils literal notranslate"><span class="pre">FileNotFoundError</span></code>, cuyo origen tenemos claro.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  línea a línea</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fich_ent</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_colunna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1"># Línea &quot;artificial&quot; para generar un error de índice en nuestro ejemplo</span>
    <span class="c1"># Cambiando 9 por 10 el programa no genera error</span>
    <span class="n">num_valores</span> <span class="o">=</span> <span class="mi">9</span>  
    <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">num_valores</span>  
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fich_ent</span><span class="p">):</span>
        <span class="n">lista_enteros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cerramos el fichero.&#39;</span><span class="p">)</span>
    <span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Errno 2] No such file or directory: &#39;valores_en_colunna.txt&#39;
Cerramos el fichero.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="n">b25879e149e4</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cerramos el fichero.&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">17</span>     <span class="n">fich_ent</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Cierre</span>

<span class="ne">NameError</span>: name &#39;fich_ent&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><strong>¿Qué está pasando?</strong></p>
<p>El problema es que la excepción <code class="docutils literal notranslate"><span class="pre">FileNotFoundError</span></code> se genera en la parte derecha de la asignación a la variable <code class="docutils literal notranslate"><span class="pre">fich_ent</span></code>, al abrir un fichero que no existe. Y la asignación nunca llega a producirse y, por tanto, la variable <code class="docutils literal notranslate"><span class="pre">fich_ent</span></code> no llega a estar definida nunca.</p>
<p>Nuestro <code class="docutils literal notranslate"><span class="pre">finally</span></code> tal y como está programado no nos ayuda. Podríamos solventar el problema a través de la utilización de código más verboso, pero hay mejores opciones.</p>
<div class="section" id="el-administrador-de-recursos-with">
<h3>El administrador de recursos <code class="docutils literal notranslate"><span class="pre">with</span></code><a class="headerlink" href="#el-administrador-de-recursos-with" title="Permalink to this headline">¶</a></h3>
<p>A partir de la versión 2.6 de Python se introdujo una <em>nueva estructura</em> de control de flujo, la construcción <code class="docutils literal notranslate"><span class="pre">with</span></code>. La estructura <code class="docutils literal notranslate"><span class="pre">with</span></code> ha sido <em>diseñada</em> específicamente para lidiar con código donde se manejan <strong>objetos</strong> que utilizan <strong>recursos</strong> externos. Por ello, Python define a la estructura <code class="docutils literal notranslate"><span class="pre">with</span></code> como un <strong>administrador de recursos</strong> (<strong>context manager</strong>).</p>
<p>Además de los ficheros, un <strong>administrador de recursos</strong> como <code class="docutils literal notranslate"><span class="pre">with</span></code> puede trabajar con otros objetos, tales como aquellos dedicados a gestionar conexiones a red, bases de datos, etc.. En todos ellos, se deben tener en cuenta una serie de pasos o <em>estados</em> y donde los recursos son <em>aquiridos</em> y deben ser <em>liberados</em> o <em>cerrados</em> aún en presencia de <strong>excepciones</strong>.</p>
<p>Veámos el ejemplo anterior usando <code class="docutils literal notranslate"><span class="pre">with</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  línea a línea</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich_ent</span><span class="p">:</span> 
        <span class="c1"># Línea &quot;artificial&quot; para generar un error de índice en nuestro ejemplo</span>
        <span class="c1"># Cambiando 9 por 10 el programa no genera error</span>
        <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span>  <span class="c1"># Línea &quot;artificial&quot; para generar un error de índice en nuestro ejemplo</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fich_ent</span><span class="p">):</span>
            <span class="n">lista_enteros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
</pre></div>
</div>
</div>
</div>
<p>La construcción <code class="docutils literal notranslate"><span class="pre">with</span></code> crea un <em>contexto</em> que ante la presencia de posible excepciones maneja el <em>recurso</em> que representa el fichero. En este caso, ya no es necesario <em>cerrar explícitamente</em> el fichero utilizando <code class="docutils literal notranslate"><span class="pre">close()</span></code>: el <strong>administrador de contexto</strong> creado con <code class="docutils literal notranslate"><span class="pre">with</span></code> se ocupa de todos estos detalles <em>tras las bambalinas</em>.</p>
<p>Vistas estas ventajas, usaremos a partir de ahora, la estructura <code class="docutils literal notranslate"><span class="pre">with</span></code>.</p>
<hr class="docutils" />
<p><a id='Otras_formas_de_lectura_en_Python'></a></p>
</div>
</div>
<div class="section" id="otras-formas-de-lectura-en-python">
<h2>Otras formas de lectura en Python<a class="headerlink" href="#otras-formas-de-lectura-en-python" title="Permalink to this headline">¶</a></h2>
<p>Una alternativa a leer línea por línea es hacerlo en <strong>un único paso</strong>:</p>
<ul class="simple">
<li><p>usando el método <code class="docutils literal notranslate"><span class="pre">readlines()</span></code>. Se crea una lista con las cadenas de caracteres de cada una de las líneas.</p></li>
<li><p>usando el método <code class="docutils literal notranslate"><span class="pre">read()</span></code>. Obtendremos una única cadena de caracteres unión de todas las líneas, incluidos los retornos de línea.</p></li>
</ul>
<p>Debemos señalar que estas funciones pueden usarse con un argumento indicando el número de caracteres a leer, opción que no estudiaremos.</p>
<div class="section" id="ejemplo-de-uso-de-readlines">
<h3>Ejemplo de uso de <code class="docutils literal notranslate"><span class="pre">readlines()</span></code><a class="headerlink" href="#ejemplo-de-uso-de-readlines" title="Permalink to this headline">¶</a></h3>
<p>Para el fichero que estamos manejando, podemos observar que el código es menos compacto que con el método de lectura iterada línea por línea.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  con readlines()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich_ent</span><span class="p">:</span> 
        <span class="n">lista_lineas</span> <span class="o">=</span> <span class="n">fich_ent</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>    
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lista con las líneas del fichero</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lista_lineas</span><span class="p">))</span>
    <span class="c1"># Transformamos cada una de las líneas en el entero correspondiente</span>
    <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lista_lineas</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lista_lineas</span><span class="p">):</span>
        <span class="n">lista_enteros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linea</span><span class="p">)</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lista con los enteros del fichero</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ejemplo-de-uso-de-read">
<h3>Ejemplo de uso de <code class="docutils literal notranslate"><span class="pre">read()</span></code><a class="headerlink" href="#ejemplo-de-uso-de-read" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  con read()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich_ent</span><span class="p">:</span> 
        <span class="n">lineas_unidas</span> <span class="o">=</span> <span class="n">fich_ent</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Una única cadena de caracteres correspondiente a todo el fichero</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineas_unidas</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>¡Atención! Lo que hemos sacado por pantalla es una única cadena de caracteres, la cadena <code class="docutils literal notranslate"><span class="pre">'1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n'</span></code>, en cuyo interior hay caracteres nueva línea <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
<p>Si utilizamos esta alternativa, para extraer nuestra secuencia de números enteros, podemos recurrir al método <code class="docutils literal notranslate"><span class="pre">split()</span></code> asociado a las cadenas de caracteres. El método <code class="docutils literal notranslate"><span class="pre">split()</span></code> extrae las <em>palabras</em> de la cadena de caracteres situadas entre espacios en blanco, que incluyen tabuladores, retornos de líneas, etc.. Este método ya lo hemos usado cuando introducíamos por teclado valores <em>secuencialmente separados por espacios sin usar intro</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  con read()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_columna.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich_ent</span><span class="p">:</span> 
        <span class="n">lineas_unidas</span> <span class="o">=</span> <span class="n">fich_ent</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">palabra</span> <span class="ow">in</span> <span class="n">lineas_unidas</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="n">lista_enteros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">palabra</span><span class="p">))</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lista con los enteros del fichero en columna</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Con este método, estamos en condiciones de procesar también nuestro archivo de números en una sóla línea <em>valores_en_fila.txt</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># Leyendo del fichero &quot;valores_en_columna.txt&quot;  con read()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;valores_en_fila.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich_ent</span><span class="p">:</span> 
        <span class="n">lineas_unidas</span> <span class="o">=</span> <span class="n">fich_ent</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">lista_enteros</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">palabra</span> <span class="ow">in</span> <span class="n">lineas_unidas</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="n">lista_enteros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">palabra</span><span class="p">))</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lista con los enteros del fichero en fila</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lista_enteros</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Debemos recalcar que existen más posibilidades de lectura de los ficheros, que pueden consultarse en la <a class="reference external" href="https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files">documentación de Python</a>, pero, entre todas, la lectura línea por línea es probablemente la más fácil y más utilizada.</p>
<hr class="docutils" />
<p><a id='Leyendo_un_fichero_con_formato_complejo'></a></p>
</div>
</div>
<div class="section" id="leyendo-un-fichero-con-formato-complejo">
<h2>Leyendo un fichero con formato complejo<a class="headerlink" href="#leyendo-un-fichero-con-formato-complejo" title="Permalink to this headline">¶</a></h2>
<p>Los dos ejemplos de ficheros vistos hasta el momento tienen una estructura muy simple, lo que no significa que no sean útiles.</p>
<p>Las aplicaciones prácticas requieren ser capaces de <strong>crear</strong> y <strong>leer</strong> ficheros que tengan una <em>estructura compleja</em> conocida de tamaño arbitrario, en dependencia del número de datos que estos ficheros almacenen. En estos ficheros pueden mezclarse comentarios y datos tanto numéricos como cadenas de caracteres.</p>
<p>Para dar sólo algunos ejemplos de los imnumerables que pudieran citarse, un fichero podría contener:</p>
<ul class="simple">
<li><p>los datos del censo de una ciudad o un país: nombre y apellidos, DNI, dirección y edad de los votantes.</p></li>
<li><p>la sucesión de temperaturas recogidas por un <strong>sensor</strong> en determinado lugar.</p></li>
<li><p>las filas y columnas de una matriz de dimensiones arbitrarias.</p></li>
<li><p>los datos, organizados en número arbitrario de ejes, de un estudio epidemiológico, etc.</p></li>
</ul>
<p>Todos los problemas tienen en común que el <strong>significado de los datos</strong> y <strong>la estructura básica</strong> de la organización de los mismos <strong>tienen que ser conocidos por el programador</strong>. El <em>volumen</em> total de los datos (cantidad de personas, número de lecturas del sensor, dimensiones de la matriz, numero de ejes y cantidad de elementos por eje) es, en general, desconocido.</p>
<p>La figura siguiente muestra el fichero <em>almacen.txt</em>, cuyo formato es algo más complejo y formado por:</p>
<ul class="simple">
<li><p>Una línea inicial que es un comentario explicativo del contenido del fichero, en general, útil solo para el usuario que lo abre directamente desde un editor de textos.</p></li>
<li><p>Una serie de líneas que contienen cada una de ellas una referencia de un producto y su precio.</p></li>
</ul>
<p><img alt="almacen.jpg" src="notebooks\12_Ficheros\img\img/almacen.jpg" /></p>
<p>Veamos un posible fragmento para su lectura.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leyendo el fichero &quot;almacen.txt&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;almacen.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich</span><span class="p">:</span>
        <span class="n">fich</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># Leemos la primera línea pero la obviamos</span>
        <span class="n">producto</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">precio</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich</span><span class="p">:</span>
            <span class="n">palabras</span> <span class="o">=</span> <span class="n">linea</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">producto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">palabras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">precio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">palabras</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">producto</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ref_1&#39;, &#39;ref_2&#39;, &#39;ref_3&#39;, &#39;ref_4&#39;]
[1.5, 2.1, 9.98, 4.41]
</pre></div>
</div>
</div>
</div>
<p>Vamos a introducir en el siguiente fragmento dos mejoras:</p>
<ul class="simple">
<li><p>Leemos el fichero a través de una función, encapsulando su código</p></li>
<li><p>Creamos una lista de tuplas con la pareja (referencia, precio)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="k">def</span> <span class="nf">lee_fichero</span><span class="p">(</span><span class="n">nombre</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich</span><span class="p">:</span>
            <span class="n">fich</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># Leemos la primera línea pero la obviamos</span>
            <span class="n">listado_precios</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="n">fich</span><span class="p">:</span>
                <span class="n">palabras</span> <span class="o">=</span> <span class="n">linea</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">listado_precios</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">palabras</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">palabras</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">listado_precios</span>

    
<span class="c1"># Programa principal</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="n">lee_fichero</span><span class="p">(</span><span class="s1">&#39;almacen.txt&#39;</span><span class="p">)</span>  <span class="c1"># Prueba a introducir un nombre erróneo</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;ref_1&#39;, 1.5), (&#39;ref_2&#39;, 2.1), (&#39;ref_3&#39;, 9.98), (&#39;ref_4&#39;, 4.41)]
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><a id='Escritura_en_un_fichero'></a></p>
</div>
<div class="section" id="escritura-en-un-fichero">
<h2>Escritura en un fichero<a class="headerlink" href="#escritura-en-un-fichero" title="Permalink to this headline">¶</a></h2>
<p>La escritura en un fichero es comparativamente algo más simple que la lectura. No en vano, es el programador
el que controla cómo es la estructura del fichero. Además, puede <em>despreocuparse</em> de elementos tales como los retornos de línea, espacios en blanco, etc.</p>
<p>Aunque puede usarse la función <code class="docutils literal notranslate"><span class="pre">print()</span></code> para escribir en un fichero el método relevante es <code class="docutils literal notranslate"><span class="pre">write()</span></code>.
A diferencia de <code class="docutils literal notranslate"><span class="pre">print()</span></code>, el método <code class="docutils literal notranslate"><span class="pre">write()</span></code> no añade un retorno de línea por defecto al escribir en el fichero.</p>
<p>Si necesitamos añadir una línea, no tenemos mas que añadir a la cadena correspondiente el carácter <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
<p>Otro aspecto importante es ser conscientes de lo que ocurre si abrimos un fichero para escritura usando el modo de apertura <code class="docutils literal notranslate"><span class="pre">'w'</span></code>:</p>
<ul class="simple">
<li><p>Si el fichero no existe, se creará uno nuevo con ese nombre</p></li>
<li><p>Si el fichero ya existe, se borrará su contenido</p></li>
</ul>
<p>En el siguiente fragmento, vamos a crear un fichero <em>almacen_clon.txt</em>, idéntico a <em>almacen.txt</em>, usando todas las herramientas que ya conocemos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="k">def</span> <span class="nf">escribe_fichero</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">comentario</span><span class="p">,</span> <span class="n">lista</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich</span><span class="p">:</span>
            <span class="n">fich</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comentario</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Escribimos el comentario</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lista</span><span class="p">:</span>
                <span class="n">fich</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    

<span class="c1"># Programa principal</span>
<span class="n">comentario</span> <span class="o">=</span> <span class="s1">&#39;Lista de productos y precios en Euros&#39;</span>
<span class="n">listado_precios</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;ref_1&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ref_2&#39;</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ref_3&#39;</span><span class="p">,</span> <span class="mf">9.98</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ref_4&#39;</span><span class="p">,</span> <span class="mf">4.41</span><span class="p">)]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">escribe_fichero</span><span class="p">(</span><span class="s1">&#39;almacen_clon.txt&#39;</span><span class="p">,</span> <span class="n">comentario</span><span class="p">,</span> <span class="n">listado_precios</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>En lugar de utilizar el método <code class="docutils literal notranslate"><span class="pre">write()</span></code> se podría haber utilizado la propia función <code class="docutils literal notranslate"><span class="pre">print()</span></code> que hemos venido utilizando para la salida por la consola (asociada normalmente a la pantalla).</p>
<p>Para que escriba en un fichero diferente a la consola, que es el <em>fichero por defecto</em>, se puede utilizar el parámetro formal <code class="docutils literal notranslate"><span class="pre">file</span></code> de <code class="docutils literal notranslate"><span class="pre">print()</span></code>de la manera que se muestra:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cadena</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">fich</span><span class="p">)</span>
</pre></div>
</div>
<p>Como ya sabemos, la función <code class="docutils literal notranslate"><span class="pre">print()</span></code> si incluye automáticamente el cambio de línea al final de la cadena procesada.</p>
<p>La versión usando <code class="docutils literal notranslate"><span class="pre">print()</span></code> sería la siguiente:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="k">def</span> <span class="nf">escribe_fichero</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">comentario</span><span class="p">,</span> <span class="n">lista</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fich</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">comentario</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">fich</span><span class="p">)</span>  <span class="c1"># Escribimos el comentario</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lista</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">file</span><span class="o">=</span><span class="n">fich</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    

<span class="c1"># Programa principal</span>
<span class="n">comentario</span> <span class="o">=</span> <span class="s1">&#39;Lista de productos y precios en Euros&#39;</span>
<span class="n">listado_precios</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;ref_1&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ref_2&#39;</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ref_3&#39;</span><span class="p">,</span> <span class="mf">9.98</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ref_4&#39;</span><span class="p">,</span> <span class="mf">4.41</span><span class="p">)]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">escribe_fichero</span><span class="p">(</span><span class="s1">&#39;almacen_clon_print.txt&#39;</span><span class="p">,</span> <span class="n">comentario</span><span class="p">,</span> <span class="n">listado_precios</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><a id='Consideraciones_finales'></a></p>
</div>
<div class="section" id="consideraciones-finales">
<h2>Consideraciones finales<a class="headerlink" href="#consideraciones-finales" title="Permalink to this headline">¶</a></h2>
<p>En lo anterior, se han discutido algunos conceptos elementales para leer y/o escribir ficheros con Python.</p>
<p>En muchas ocasiones, este acceso básico, es todo lo que se requiere.</p>
<p>Consecuente con su filosofía, Python ofrece recursos de un mayor nivel de abstracción para lidiar de forma productiva con ficheros que siguen una estructura más compleja. Esta estructura puede ir desde simples ficheros en los que los datos aparecen en columnas separados por comas <code class="docutils literal notranslate"><span class="pre">,</span></code> u otros separadores, llamados ficheros tipo <strong>csv</strong> (<strong>comma separated values</strong>), hasta aquellos ficheros que sirven como infraestructura a <strong>bases de datos</strong>.</p>
<p>Sin pretender catalogar todas las posibilidades, entre los recursos que brinda el <em>ecosistema</em> de Python para trabajar con ficheros de diferentes estructuras, se tienen:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/csv.html">Módulo csv (biblioteca estándar de Python)</a>: Ficheros csv.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/xml.html">Módulo XML (biblioteca estándar de Python)</a>: Para trabajar con ficheros códificados el estándar XML</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/json.html">Módulo JSON (biblioteca estándar de Python)</a>: Para ficheros codificados en el estándar JSON (Javascript Object Notation) el estándar <em>de facto</em> en intercambio de información.</p></li>
<li><p><a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/">OpenPyXL</a>: Bilioteca para la manipulación de hojas de cálculo <strong>Excel</strong>.</p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/">Pandas</a>: Para análisis y manipulación de datos.</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks\12_Ficheros\img"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Félix Miguel Trespaderne / Rogelio Mazaeda Echevarría<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>